<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>JedR Academy - Categorization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      JedR Academy
      </li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">JedR Academy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/trials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JedR Trials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/training.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">JedR Trainings</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contribution</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-make-categories-from-data" id="toc-how-to-make-categories-from-data" class="nav-link active" data-scroll-target="#how-to-make-categories-from-data">How to make categories from data</a>
  <ul class="collapse">
  <li><a href="#goals-of-this-training-session" id="toc-goals-of-this-training-session" class="nav-link" data-scroll-target="#goals-of-this-training-session">Goals of this training session</a></li>
  </ul></li>
  <li><a href="#our-scenario" id="toc-our-scenario" class="nav-link" data-scroll-target="#our-scenario">Our scenario</a></li>
  <li><a href="#using-case_match" id="toc-using-case_match" class="nav-link" data-scroll-target="#using-case_match">Using <code>case_match()</code></a>
  <ul class="collapse">
  <li><a href="#how-case_match-works" id="toc-how-case_match-works" class="nav-link" data-scroll-target="#how-case_match-works">How case_match works</a></li>
  <li><a href="#using-.default" id="toc-using-.default" class="nav-link" data-scroll-target="#using-.default">Using .default</a></li>
  <li><a href="#check-your-results" id="toc-check-your-results" class="nav-link" data-scroll-target="#check-your-results">Check your results</a></li>
  </ul></li>
  <li><a href="#padawan-practice-case_match" id="toc-padawan-practice-case_match" class="nav-link" data-scroll-target="#padawan-practice-case_match">Padawan practice: case_match</a></li>
  <li><a href="#using-case_when" id="toc-using-case_when" class="nav-link" data-scroll-target="#using-case_when">Using <code>case_when()</code></a>
  <ul class="collapse">
  <li><a href="#a-more-complex-example" id="toc-a-more-complex-example" class="nav-link" data-scroll-target="#a-more-complex-example">A more complex example</a></li>
  </ul></li>
  <li><a href="#padawan-practice-case_when" id="toc-padawan-practice-case_when" class="nav-link" data-scroll-target="#padawan-practice-case_when">Padawan practice: case_when</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Categorization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<pre class="{webr}"><code>#| include: FALSE
praise_list &lt;- c("Great job you have done!", "Nice work. You have controlled your fear.", "Wow! The force is with you!", "Great job! Mind tricks don't work on you!", "The Force is strong with you!", "You’ve mastered this task like a true Jedi Knight.", "Your skills rival those of a seasoned Jedi Master.", "The galaxy is lucky to have someone as strong and brave as you.", "The Rebellion couldn’t ask for a better ally.", "You’re the hope the galaxy needs!", "Not even the Death Star could stand in your way.", "Darth Vader would tremble in your presence!", "Even a bounty hunter would be impressed by your precision and focus.", "You’ve got the strength of a thousand stormtroopers (but with way better aim)!", "Like a true Jedi, you face challenges with courage and wisdom.")

random_praise &lt;- sample(praise_list, 1)

again_list &lt;- c("Even Yoda didn’t get it on the first try. Keep going, young Padawan!", "The Force is strong with you—just focus and try again.", "Every Jedi stumbles before mastering the lightsaber. Give it another go!", "Remember, the greatest pilots still had to learn to fly first.", "Even Han Solo missed a few shots—try again, and you’ll hit the mark.", "No need to go to the Dark Side; persistence will bring you victory!", "The path of the Jedi is filled with lessons. This is just one of them.", "Even Anakin faced failure; it’s how you rise that matters.", "Not even a Sith Lord could conquer every challenge the first time.", "Mistakes are like hyperspace jumps: each one gets you closer to the destination.", "The Rebellion wasn’t won in a day — keep fighting for what’s possible.","Think of this as training with Master Yoda: patience leads to mastery.", "The Force is with you, always, so don’t give up now!", "Just like rebuilding a lightsaber, try again, and you'll get it right.")

random_again &lt;- sample(again_list, 1)

gender_reveal &lt;- starwars |&gt; 
  mutate(
    gender_clean = case_match(
      gender,
      NA ~ "unknown",
      .default = gender
    )) |&gt; 
  select(name, gender, gender_clean)

mainchars &lt;- starwars |&gt; 
  mutate(
    main_planet_origin = case_when(
      str_detect(homeworld, "Tatooine|Naboo") ~ TRUE,
      .default = FALSE
    )) |&gt; 
  select(name, homeworld, main_planet_origin)</code></pre>
</div>
<section id="tutorial-by-christian-mcdonald-jedr-master" class="level5">
<h5 class="anchored" data-anchor-id="tutorial-by-christian-mcdonald-jedr-master">Tutorial by: Christian McDonald, JedR master</h5>
</section>
<section id="how-to-make-categories-from-data" class="level2">
<h2 class="anchored" data-anchor-id="how-to-make-categories-from-data">How to make categories from data</h2>
<p>Welcome Padawan. May your quest to become a JedR Master be fruitful. “Do or do not. There is no try.”</p>
<p>Sometimes as journalists (or data scientists) we need to create new categories for our data. An example might be where we have a column of data that has too many different values to plot effectively. We might be able to re-categorize those values to fewer individual choices, maybe combining less important values into a generic term like “other”.</p>
<p>Some real-worldish examples:</p>
<ul>
<li>You want to show race/ethnicity breakdowns in a chart or story about Hispanic representation. There are eight different values and some are quite small. You might create a column to use the values Asian, Black, Hispanic and White with all others changed to “Other”.</li>
<li>Perhaps you are doing a story on crime and want to highlight violent crimes vs property vs other crimes. You might create a new column that categorizes many individual charges into these buckets.</li>
</ul>
<p>We’re taking records and putting them into piles or groups based on one or more values.</p>
<blockquote class="blockquote">
<p><strong>JedR Mind Trick:</strong> When we categorize values like this, we want to create a new column intead of overwriting an existing one. This way you can check your work. You can always remove or rename columns later.</p>
</blockquote>
<section id="goals-of-this-training-session" class="level3">
<h3 class="anchored" data-anchor-id="goals-of-this-training-session">Goals of this training session</h3>
<ul>
<li>To apply <a href="https://dplyr.tidyverse.org/reference/case_match.html"><code>case_match()</code></a> within a <code>mutate()</code> to create data categories. It’s a one-to-one match, for the most part.</li>
<li>To apply <a href="https://dplyr.tidyverse.org/reference/case_when.html"><code>case_when()</code></a> within a <code>mutate()</code> to create data categories. This allows more complex logic.</li>
</ul>
</section>
</section>
<section id="our-scenario" class="level2">
<h2 class="anchored" data-anchor-id="our-scenario">Our scenario</h2>
<p>Here at the <em>Galactic News Hub</em>, we have a dataset of all the sources we connect with on a regular basis: The <code>starwars</code> data set that comes with the <code>tidyverse</code> library.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
#| message: FALSE
#| label: showcase
library(tidyverse)
starwars</code></pre>
</div>
<p>This data includes a variable called <code>species</code>, and our editor wants a report breaking down the species of our source list based on three broad categories: <strong>human</strong>, <strong>droid</strong>, and <strong>other</strong>. Our editor is hoping we can later cross reference these categories against gender and other variables within the source list.</p>
<p>To accomplish this, it would be helpful to have a “species_category” variable using these three values so we can group and aggregate with other columns.</p>
<p>Let’s take a look at the species column using <a href="https://dplyr.tidyverse.org/reference/count.html"><code>count()</code></a>.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: false
starwars |&gt; count(species, sort = TRUE, name = "cnt")</code></pre>
</div>
<p>You can see that <strong>Human</strong> and <strong>Droid</strong> values dominate the data. The next most frequent values is <code>NA</code>. Maybe we can convince our editor to make that category <strong>Other/Unknown</strong>.</p>
</section>
<section id="using-case_match" class="level2">
<h2 class="anchored" data-anchor-id="using-case_match">Using <code>case_match()</code></h2>
<p>One of the easier methods to categorize data is to use <a href="https://dplyr.tidyverse.org/reference/case_match.html"><code>case_match()</code></a>. The logic is straighforward: For this value, substitute that value.</p>
<p>To make clear our goal here for the <em>Galactic Hub News</em>: We want to create a new column called <code>species_category</code> that has three values: Human, Droid, Other/Unknown. And they need to be based on the existing <code>species</code> variable.</p>
<section id="how-case_match-works" class="level3">
<h3 class="anchored" data-anchor-id="how-case_match-works">How case_match works</h3>
<p>While is is possible to recatagorize our values into the same column, a good JedR will instead use <code>mutate()</code> and <code>case_when()</code> to create a new column and then fill it with the results.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_column =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      existing_column,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Old Value 1 from existing_column"</span> <span class="sc">~</span> <span class="st">"New Value 1"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Old Value 2 from existing_column"</span> <span class="sc">~</span> <span class="st">"New Value 2"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="st">"Value for everything else"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>This is standard usage for the <code>mutate()</code> function … you create the new column and then set it to a value. In this case, we are setting the value to the result of the <code>case_when()</code> function.</li>
<li>Within <code>case_when()</code>, we have to first name the column we are pulling from. Like where are we looking for these values?</li>
<li>Then we have a series of statements separated with <code>~</code>. If we find what is on the left-hand side, then we change it to what is on the right-hand side.</li>
<li>Lastly we have a “default” to handle everything else we haven’t specified. In some cases you might make this <code>.default = existing_column</code> to keep the existing value for those rows.</li>
</ul>
<p>The order you put these is important. Once a match has been found and updated, that value won’t be changed again.</p>
<p>So, with our <code>starwars</code> data, a partial solution might look like this:</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
starwars |&gt; 
  mutate(
    species_category = case_match(
      species,
      "Gungan" ~ "Other/Unknown",
      "Neimodian" ~ "Other/Unknown"
    )
  ) |&gt; # using select and slice to focus on the change
  select(name, species, species_category) |&gt; slice(31:40)</code></pre>
</div>
<p>In the example above, we use <code>slice()</code> to skip down to part of the data where we can see the change. (The first 20 rows are all humans and droids.) We also used <code>select()</code> to focus on our columns of interest.</p>
<p>Note we’ve only changed <em>two</em> of the values we need to change, though. (You can see Toydarian and Dug have not been changed.) This method is very handy if you have just a few things to change.</p>
<p>In our case here, we <em>could</em> list all 36 changes, but … Use the Force, Luke.</p>
</section>
<section id="using-.default" class="level3">
<h3 class="anchored" data-anchor-id="using-.default">Using .default</h3>
<p><code>case_match()</code> changes exactly what you specify and leaves anything you don’t specify as <code>NA</code>. If you want the non-matches to be something else, you can specify them with <code>.default =</code>.</p>
<p>Using this, we can set Human to Human and Droid to Droid, but then everything else to Other/Unknown.</p>
<p><strong>NOTE</strong> that the specific matches use <code>~</code> to separate what to look for and what to change it to, but the <code>.default</code> designation uses <code>=</code>.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
starwars |&gt; 
  mutate(
    species_category = case_match(
      species,
      "Human" ~ "Human",
      "Droid" ~ "Droid",
      .default = "Other/Unknown",
    )
  ) |&gt; # using select and slice to focus on change
  select(name, species, species_category) |&gt; slice(31:40)</code></pre>
</div>
</section>
<section id="check-your-results" class="level3">
<h3 class="anchored" data-anchor-id="check-your-results">Check your results</h3>
<blockquote class="blockquote">
<p><strong>JedR Mind Trick:</strong> Even with these few rows, it’s hard to <em>see all</em> the changes made in your data. It is sometimes helpful to do a <code>count()</code> on your changes to check them. Just be sure to count the already-changed data, not the result you are saving into the new object.</p>
</blockquote>
<p>Here we save the recategorized data into a new object called <code>sw_species</code> and then run a <code>count()</code> on our two columns to check the results.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
sw_species &lt;- starwars |&gt; 
  mutate(
    species_category = case_match(
      species,
      "Human" ~ "Human",
      "Droid" ~ "Droid",
      .default = "Other/Unknown",
    )
  )

sw_species |&gt; 
  count(species, species_category, sort = TRUE)</code></pre>
</div>
<p>The <code>case_match()</code> function works great if you have one-to-one changes that don’t require logic. But when you have more complex needs, we need more Force.</p>
</section>
</section>
<section id="padawan-practice-case_match" class="level2">
<h2 class="anchored" data-anchor-id="padawan-practice-case_match">Padawan practice: case_match</h2>
<p>If you look at the <code>gender</code> column in the data, you’ll see there are two values: <strong>masculine</strong> and <strong>feminine</strong>, but there are four records that don’t have a <code>gender</code> value are listed as <code>NA</code>.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
starwars |&gt; count(gender)</code></pre>
</div>
<p>For this quest, you will use <code>case_match()</code> to fill in those blank values with <strong>unknown</strong>.</p>
<p>Note in the code we are creating a new dataframe and filling with mutated <code>starwars</code> data.</p>
<p>Within the case_match section you’ll need to note what variable you are working from, what to do if that value is NA, and set the remainder using a default.</p>
<p>At the end it prints the results.</p>
<div class="cell" data-exercise="ex_1">
<pre class="{webr}"><code>#| exercise: ex_1
gender_reveal &lt;- starwars |&gt; 
  mutate(
    gender_clean = case_match(
      ______,
      ______,
      ______
    )) |&gt; 
  select(name, gender, gender_clean)

gender_reveal</code></pre>
</div>
<div class="cell" data-exercise="ex_1" data-check="true">
<pre class="{webr}"><code>#| exercise: ex_1
#| check: true
if (identical(.result, gender_reveal &lt;- starwars |&gt; 
  mutate(
    gender_clean = case_match(
      gender,
      NA ~ "unknown",
      .default = gender
    )) |&gt; 
  select(name, gender, gender_clean))) {
  list(correct = TRUE, message = sample(praise_list, 1))
} else {
  list(correct = FALSE, message = sample(again_list, 1))
}</code></pre>
</div>
</section>
<section id="using-case_when" class="level2">
<h2 class="anchored" data-anchor-id="using-case_when">Using <code>case_when()</code></h2>
<p>The <a href="https://dplyr.tidyverse.org/reference/case_when.html"><code>case_when()</code></a> function is useful when you need to set new values based on some kind of logic.</p>
<p>Here we will use <code>case_when</code> to do the same thing we did above with <code>case_match()</code> and then explain how it is working below.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
starwars |&gt; 
  mutate(
    species_category = case_when(
      species == "Human" ~ "Human",
      species == "Droid" ~ "Droid",
      .default = "Other/Unknown"
    )
  ) |&gt;
  select(name, species, species_category) |&gt; slice(31:40)</code></pre>
</div>
<p>You can see the syntax works differently (once we are past the mutate).</p>
<ul>
<li>Within the <code>case_when()</code>, there are rules that split with <code>~</code>. On the left is a logical test, and on the right is a new value designation.</li>
<li>Each rule is run in order. A value is set only once, so if a value is set in one rule, it will NOT be reset by subsequent rules. You must write your rules from the most specific to the most general.</li>
<li>The last line <code>.default =</code> handles all values not already changed. If left out, values not specified would be set <code>NA</code>.</li>
</ul>
<section id="a-more-complex-example" class="level3">
<h3 class="anchored" data-anchor-id="a-more-complex-example">A more complex example</h3>
<p>Unlike <code>case_match()</code> where you are drawing from values in one specific column, the logic tests used with <code>case_when()</code> can be just about anything as long as they evaluate to <code>TRUE</code> or <code>FALSE</code>.</p>
<p>While this is a silly example, here we create a column called <code>size_compare</code> that notes if a character is “larger” or “smaller” than an average human, unless they are a droid, in which case they are labeled “mechanical”.</p>
<div class="cell" data-edit="false">
<pre class="{webr}"><code>#| edit: FALSE
starwars |&gt; 
  mutate(
    size_compare = case_when(
      species == "Droid" ~ "mechanical",
      height &gt;= 170 &amp; mass &gt;= 80 ~ "larger",
      .default = "smaller"
    )
  ) |&gt; 
  select(name, size_compare)</code></pre>
</div>
<p>Note we started with the rule for “Droid” because that is the most specific thing we needed to change. When then set the “larger” value, and the rest got “smaller.”</p>
</section>
</section>
<section id="padawan-practice-case_when" class="level2">
<h2 class="anchored" data-anchor-id="padawan-practice-case_when">Padawan practice: case_when</h2>
<p>Create a column called <code>main_planet</code> using the <code>homeworld</code> column. For each characters with a homeworld of “Tatooine” or “Naboo”, label it as <code>TRUE</code> and otherwise label as <code>FALSE</code>, which will create a logical datatype column.</p>
<p>(This is a fill-in-the-blank thing …)</p>
<div class="cell" data-exercise="ex_2">
<pre class="{webr}"><code>#| exercise: ex_2
mainchars &lt;- starwars |&gt; 
  mutate(
    main_planet_origin = case_when(
      str_detect(_________, "Tatooine|Naboo") ~ ____,
      .default = _____
    )) |&gt; 
  select(name, homeworld, main_planet_origin)

mainchars</code></pre>
</div>
<div class="cell" data-exercise="ex_2" data-check="true">
<pre class="{webr}"><code>#| exercise: ex_2
#| check: true
if (identical(.result, mainchars &lt;- starwars |&gt; 
  mutate(
    main_planet_origin = case_when(
      str_detect(homeworld, "Tatooine|Naboo") ~ TRUE,
      .default = FALSE
    )) |&gt; 
  select(name, homeworld, main_planet_origin))) {
  list(correct = TRUE, message = sample(praise_list, 1))
} else {
  list(correct = FALSE, message = sample(again_list, 1))
}</code></pre>
</div>
<p>Page through your results to check your answers.</p>
<p>That’s it for now.</p>
<p>-30-</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>